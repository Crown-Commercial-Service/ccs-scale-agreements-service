language: java
script: mvn package
cache:
  directories:
  - "$HOME/.m2"

branches:
  only:
  - "/^(feature|bugfix)\\/SCC-[0-9]+.*$/"
  - "/^(release)\\/.*$/"
  - bat/develop
  - main

# Install dependencies
before_install:
  - sudo rm -Rf terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo rm -Rf terraform
  - wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
  - unzip terraform_"$TF_VERSION"_linux_amd64.zip
  - sudo mv terraform /usr/local/bin/
  - rm terraform_"$TF_VERSION"_linux_amd64.zip

deploy:

# SBX - modify CF_ENVIRONMENT as required
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=sbx2 bash ./deploy.sh
  on:
    all_branches: true
    condition: "${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH} =~ ^(feature|bugfix)\\/SCC-[0-9]+.*$"

# DEVELOP    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=dev bash ./deploy.sh
  on:
    branch: bat/develop
    
# INT (SIT)    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=int bash ./deploy.sh
  on:
    branch: release/int

# NFT    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=nft bash ./deploy.sh
  on:
    branch: release/nft
    
# UAT    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=uat bash ./deploy.sh
  on:
    branch: release/uat
    
# REF    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=ref bash ./deploy.sh
  on:
    branch: release/ref

# PRE    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=pre bash ./deploy.sh
  on:
    branch: release/pre    

# PRD    
- provider: script
  skip_cleanup: true
  script: CF_ENVIRONMENT=prd bash ./deploy.sh
  on:
    branch: release/prd    

# WARNING! Do NOT use the --add flag of travis cli encrypt - it removes all formatting and comments
env:
  global:
  # AWS_ACCESS_KEY_ID 
  - secure: "Feyxjrf7SG3DqyBEsorWNMcc1oLadIPrRdzDhS33WGK2Rr1Qv68AElNJ9o8epHQbucWtj6oQZa4v1iSpEs9ufYEtvakK15J5ebYEJqXvg85wWBwgUP+y7MBAuuCCQv1fd4/Cy/37dv3zQC7+/+Qv9bkuUpOvK9FbYaTUG4VW6dy0os6HmDcRpJUc9ffEhXk3sDPmaE6IrjM1mbqmCzjT4BvRZ1Gb03urOTJf5L7/AMrRzIRU8dJD33wrq+y5BP0PbSCZSBAtzyD9eXIde4Xsbk934vvY7X5S+xpBFaikrRYXDGl8eyTob0HL11vDeshjMmbkY2u/0awQL1qnNwlqolOdQ6X9rwwWXfdN+F+peB5rnLHisd77z7dPyIzRXGiM90tOjlu94CN5NIFiyabTCWl2Xxc7rthe6JH8rXAzCJ4lYgG8HUQoLtFtOnDlK+XHKHkD/1oO3mg/1PQYOHMKvb2qDgjl+zQJVcHC+MD9FbGGN8538wo7vOZqwcr2TzweTFkMgjEY/3Si9br7dZYBMEz5aZ8Gp+HMgzTDKY4Ri6fy7vxFnDxuvrW7nMDOEGhK/ROz+lKt5uRI8Mr/BhapRl80++bJKMzR3cUWO5lR7YOr/gm6aM774ewuat2sS/UYteL+Xjn4HgFwekEX3tLnpysmRqou8XZVkuh1OYFuNyA="
  # AWS_SECRET_ACCESS_KEY
  - secure: "MIR/bWY+J/b2kLNkIZSsBToxd0ryYRqOw7+Tku0aDwzAZlQXgd7254AlVPZDETCz6mUStqr65iIGfGK9excKcaSMjKlGbpdJHSl+C7lGei3IOCwfJMscEb87u+vaP4UqhfwhtUeXAHJqF20dzDt9xpXqBcgTshPLSvbbkANgGIbm9oCC2qeYQL1XG1ULUe7mk6guS/i1nl1jB5uMxrkDAXIui1dkKUBwo5VXeRDXVXoG8e6D1HzOSJdlUNCRYostf3dxZTFoN1GGtl0xJtLccdnujEyyP0HzgkjqVCmkaUVXtaWq1vRdMqsUuvQoROUsIsPumsmxEXFjur8NWc/xf7gMI68VA/ZqLCI5f9qNeP6s+nbiY3ehTVCLDrhQCfUQjWmaPAv71mpWR1pbjbmszsyo+HAjGKR6AHs/rq50RIz31yKVJR+Q/3hncfaf1wgVQugXLuH9LYekk6lMOBd8vHBVNPQR8BBiRSlPJ77LIo2S3lwFtuDY8fTVHzMB23jqgxE1yxm2i+TjtkO2FdE9SScAFVHzWigBfvvcGb5gGtiZcE69QmAP/uxSVE1RjYeJDNJ8Aye8BDU6BK8YoJchQQzcM/3KduIKx0NjRO8Ns4RQIMOfZBRtulObM8VfdDOiSONrGzOcMAKJd7Xhh9xxxmukwzhHnM+xA106bUCQHRU="
  # S3_STATE_BUCKET_NAME
  - secure: "k79+FO2aIlYkKqAPbvnmNYpi2y3TMtmrpUAKS4w3VfEttyIy2YwMorF2YnjOWgDIj48N1lIPIWvu0QNTJNboOh7/hWXRgPaP15A8W7aoFeOHmySKqU9MzxZ/M7IKPz+m5fk3aPxmwYBQ3PN5uA+b9om5xro50haKsz4Ej9pKk+VEX1WmED8rQ+iz2eaIvca+DPVOn/zQmbNUHKG4+hsRAj7QTBKs5v8pdbquJG8H9VckBXSH4A54fOJuqjNvNcqm4mDJ3k+eAkb+iN7MxwiImOgOEczAjtRW696vbpVi4O3X73y4qBq1tOss0CjG+EiE+l2aQ1IjEtCe0HZMjl7455PtW5my2ioYAMWULeWx6fWSrL1fulpBep1tck8H1x/UtoSbA9Ez84qXbRfydKzKIjc/z46y/vIawl0R8S6meIM0wjfwJ5OKuWJYzo4O+uaZCEdHos+8mBLACBdawIb3UrzyYBrKcNJeiAQrQh2n0QR9FYcV7xs4kYwgnbAAp0BNdOArD0JROEqfk29lWfsPBnHBwJLyGJ9Bl1BL270q2pIY3+QquZjPpdSlxij5TLwn0dJUfC500yta0peDn/sv9Yl4HAwsN2ppsWak2HrFT1zgyYj5B65ZR4JUqwl649+0JpclwzrsGCy7fuZYzMeSTjkGgMJ3cMPXR6+iBLkfNmg="
  # DDB_LOCK_TABLE_NAME
  - secure: "JxJ+LHacssw9sGDtkPOOVE2FCMv11VGy0Hyntrw7oW/qid/8IYOxiqSkozJu3oYAm4p5RmapwoHWdQP1JTaGBgy8ef9/guZRdPDX9stIqj0LQGvkpafvtgNsYipYg9IyJ7hhIqGnmIdIkDXvsP6U6jLlI66GXM4ufyFbVJujGAf8xwkh3kwxWX4qgHgBsGGVGB5F+JmW10Lpof+vsPx7XE3/0wLyAikQiRgTqJaQzQMlc9UbI1SxbPSf4jdx1dgXkiBMRNTDfU2ERBeFUVjdfLIwM8evaDiSZeLMROnYtAA/TddsvdJ01gWpyvKQJ8UG+y1RSQY5PNO8Z2DzcVTUD7o4e87+LPOigPS+P8BKuCrB3auITq4lsY+iLT60+SxyfWgXyGvv99EJpM7taEeTHVSzPG9fqoYw4KXDUDIkj2cgQ4/n/1ZuONhUTg/dzPtbVggtkm3bgByIgGur3pUVtY81sPQbKMfssWz76UM/L9jt8ijGEJEutL9G8h4GZ2n1vfb21NDulVZyBcZrmhH8fZyY+79qlWk/mQmHjVE8oJzu5jKXtiHf9E1jTvBYJSdNfK7yEu5ZKatqqOOkPOPjV1ZczLPYu9VSMm7nsovxaYU03kcWxHuzyweQlqQXo4DwG553qCexzNghO/Q3hsbXsZuAHXKT4HkDYdF9yM1z5uM="
  # CF_USERNAME
  - secure: "a9kqosKnC7OKPbR4Lw00RCZXqQ8p3v82nbIBXi/TAvbHc2iCZAou4Ik/cGI6EWYYoTwKvB1YnSvJJpSG82kSEOoVXS4kVLSXlNAY/iRl8ehEXrawHPJnunslvAyZYp6Y2wpC4Rj0h58hRYkMcgJzGKbkOkPdS6Qhxq2bNv9Vr6tsEYvRmFflnS6DHFAydKv1OXOiyeBqySMaeu6oazd6ZfFOlpEGgOvM7gQDt+JE2AUGEmzyHvDFPI/vISKkdfRa2AI4WCm6E10Ubj/4ShMlhIZh0iFBuHIg6m5XYEHfKn4InVojrNwgeiTWbsPYjzeix4cMOsAAovkqStw/u+lDIqSG24FtV6xiDYPW5G9tlWUyt5VC8xPhMbJE5st9v8wdbfCgAK6shxgIDZ/4609fKF1qn/EfP1sOmVF6kOuMNNolSjMKtRs89kC69OHg2PaxKtE8jfDTXyXfetRgT0a76hTrp2D0MmARA+9elj4BFdDu5pLiz1byRaCNxahS9upc72kkMDB3vxou5IUVlXVW6JEYZO5MvgzqWEQxtu5wZmxCnBTGQvqs29I2X/l6kl2Ej7442TTHwqGKcpG2iQzfQYKUa/PIn+5z3yh7gqiw0WbCqBc3q2GLyPifJdr1YJ8gHphHPXKQ++OJpfiLJePnpGyKfL8r30u0YSLWUXplhvY="
  # CF_PASSWORD
  - secure: "W/eP+yEpgZ/o8ck2dcVYI6Ck9net+wHJGRfaQGLdeVfua2XlfGQd5h95L2pjqefNRhrZYZqsyScDEEHnmpYuS19U94z2C/P8JOSF2tv+7ZXS3FNLcHMu064/7yvsb+fCwOzAACF9oUhz+HE8eP0zo2qhVXAwEO0RNNN/L9+Xt43NM3j2MpFqO05oh9yE4skVC/rXop7anE4XP5hfaYypQsWA/yWBqvwUjTzbyEaUo7AO9Ko7/t536FftsvGz5BtfScbWAyh5TkHP10TOmTxAIZra/GSx0yzbAr/Q/5o1OiuzngNvVE65bAL89CKVbXDEloj7pbxbDbUNzrVztvHybhM0inMnbnCf7K8ntlo/drDMBjK9Ug8KiDsHXrUvTJNuTSFBRui/6tV+01D9ywYHdGjJ6m2hp4ivBWULaFGkg6OwL4aVsJZQOK1DW6PWTO1e1rJfywT74IABg7k5NhjvYEE1CZzrEB/FSeDcjq5CM6nIKUjItLdHjzeLsMwwCZTUxUL2T0vWfWFHPpT2haMAMk4YLY3z5lQ062rSrgHwf0d2aEVZG26t1uGCVIrM+FYQ2SM5dw5PZonsqkqHv+8oOHjWef8ScibBTwCAVQ9Y7UqB3Z+YcwFIekjX1KotnPbypdae58mMMyd2imuXPng5d3JkhwWP42LwNFc3RPqF+ck="
  - TF_VERSION=1.0.5
